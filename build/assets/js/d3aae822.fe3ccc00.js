"use strict";(self.webpackChunkdatafuse=self.webpackChunkdatafuse||[]).push([[8582],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var l=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,l,a=function(e,t){if(null==e)return{};var n,l,a={},r=Object.keys(e);for(l=0;l<r.length;l++)n=r[l],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(l=0;l<r.length;l++)n=r[l],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=l.createContext({}),i=function(e){var t=l.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=i(e.components);return l.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return l.createElement(l.Fragment,{},t)}},p=l.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,u=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=i(n),m=a,f=p["".concat(u,".").concat(m)]||p[m]||d[m]||r;return n?l.createElement(f,o(o({ref:t},c),{},{components:n})):l.createElement(f,o({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=p;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var i=2;i<r;i++)o[i]=n[i];return l.createElement.apply(null,o)}return l.createElement.apply(null,n)}p.displayName="MDXCreateElement"},6039:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return u},metadata:function(){return i},toc:function(){return c},default:function(){return p}});var l=n(7462),a=n(3366),r=(n(7294),n(3905)),o=["components"],s={id:"DatafuseCli-Design",title:"DatafuseCli Design",sidebar_position:5},u="Proposal: Datafuse CLI Design Doc",i={unversionedId:"development/rfcs/DatafuseCli-Design",id:"development/rfcs/DatafuseCli-Design",isDocsHomePage:!1,title:"DatafuseCli Design",description:"Background",source:"@site/docs/development/rfcs/0005-cli-design.md",sourceDirName:"development/rfcs",slug:"/development/rfcs/DatafuseCli-Design",permalink:"/docs/development/rfcs/DatafuseCli-Design",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/development/rfcs/0005-cli-design.md",version:"current",sidebarPosition:5,frontMatter:{id:"DatafuseCli-Design",title:"DatafuseCli Design",sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Performance Test",permalink:"/docs/development/rfcs/Performance-Test"},next:{title:"Contributor License Agreement",permalink:"/docs/policies/cla"}},c=[{value:"Background",id:"background",children:[{value:"Goals",id:"goals",children:[]},{value:"Non Goals for now",id:"non-goals-for-now",children:[]}]},{value:"Installation",id:"installation",children:[]},{value:"SubCommands",id:"subcommands",children:[{value:"Cluster Create",id:"cluster-create",children:[]},{value:"Cluster List",id:"cluster-list",children:[]},{value:"Cluster View",id:"cluster-view",children:[]},{value:"Cluster delete",id:"cluster-delete",children:[]},{value:"Cluster log",id:"cluster-log",children:[]},{value:"Cluster add",id:"cluster-add",children:[]},{value:"Cluster use",id:"cluster-use",children:[]},{value:"Cluster Check",id:"cluster-check",children:[]},{value:"Cluster Analyze",id:"cluster-analyze",children:[]},{value:"Cluster Update",id:"cluster-update",children:[]},{value:"Query",id:"query",children:[]}]}],d={toc:c};function p(e){var t=e.components,n=(0,a.Z)(e,o);return(0,r.kt)("wrapper",(0,l.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"proposal-datafuse-cli-design-doc"},"Proposal: Datafuse CLI Design Doc"),(0,r.kt)("h2",{id:"background"},"Background"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"fusecli")," is a command-line tool for creating, listing, logging,\ndeleting datafuse running instances on local or\non cloud.\nIt also supports to port forward webUI, monitoring dashboard on local\nand run SQL query from command line"),(0,r.kt)("h3",{id:"goals"},"Goals"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Centralized way to manage running datafuse cluster on local or on k8s(Cloud) (start, delete, update, log)"),(0,r.kt)("li",{parentName:"ol"},"Manage and install release Instances on local machine"),(0,r.kt)("li",{parentName:"ol"},"Show different dashboards on local (prometheus, jaeger, query web UI (like querybook or superset))"),(0,r.kt)("li",{parentName:"ol"},"Support to run query or load data through command line"),(0,r.kt)("li",{parentName:"ol"},"TLS Authentication support: support client side authentication, and also support to configure mTLS for managed datafuse instances")),(0,r.kt)("h3",{id:"non-goals-for-now"},"Non Goals for now"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"More detailed managements like manage schema, table etc"),(0,r.kt)("li",{parentName:"ol"},"Query Task visualization (list and show all query tasks on current cluster)"),(0,r.kt)("li",{parentName:"ol"},"RBAC tenant management(add a subcommand tenant is helpful,\nand is compatible with this design)")),(0,r.kt)("h2",{id:"installation"},"Installation"),(0,r.kt)("p",null,"Use single line install script to install ",(0,r.kt)("inlineCode",{parentName:"p"},"fusecli")," on local machine"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl -fsS https://raw.githubusercontent.com/datafuselabs/datafuse/master/scripts/installer/install.sh | bash\n")),(0,r.kt)("h2",{id:"subcommands"},"SubCommands"),(0,r.kt)("h3",{id:"cluster-create"},"Cluster Create"),(0,r.kt)("p",null,"Create, Configure and switch to a datafuse cluster using the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fusecli cluster create --profile=<datafuse profile>\n")),(0,r.kt)("p",null,"Support three kinds of profile in alpha stage,"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"local: local profile will run standalone ",(0,r.kt)("inlineCode",{parentName:"li"},"datafuse")," cluster on local(one running fuse-query instance and one running fuse-store instance)"),(0,r.kt)("li",{parentName:"ol"},"demo: install a standalone ",(0,r.kt)("inlineCode",{parentName:"li"},"datafuse")," instance on cloud(k8s or maybe fargate in later stage)"),(0,r.kt)("li",{parentName:"ol"},"cluster: install ",(0,r.kt)("inlineCode",{parentName:"li"},"datafuse")," cluster on cloud( through ",(0,r.kt)("inlineCode",{parentName:"li"},"datafuse operator"),")")),(0,r.kt)("p",null,"Support to use flags or yaml or toml files for deployment configuration setup\nFor example:"),(0,r.kt)("p",null,"Run datafuse instance on local and setup the api address, version, tls for it"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fusecli cluster create --profile=local --set local.mysql_port=3307 --set local.http_address=127.0.0.1:7070 --set local.version=v0.4.88-nightly --set local.tls_key=<key file location>\n--set local.tls_cert=<cert file location --set local.ca_cert=<ca cert location>\n")),(0,r.kt)("p",null,"Create and configure datafuse cluster through toml file or yaml file"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fusecli cluster create -f cluster_configuration.toml\n")),(0,r.kt)("h3",{id:"cluster-list"},"Cluster List"),(0,r.kt)("p",null,"List all clusters managed by the command line (Name with ","*"," in the cluster used in current session)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fusecli cluster list\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"| NAME | PROFILE | CLUSTER | STATUS | ADDRESS | TLS |\n| default(*)| local | local | RUNNING| localhost:3307 | disabled|\n| demo | demo| minikube | RUNNING | 172.0.0.11:3307 | disabled|\n| production| cluster | GKE | RUNNING | 192.12.1.1:3307 | enabled|\n")),(0,r.kt)("h3",{id:"cluster-view"},"Cluster View"),(0,r.kt)("p",null,"View datafuse components in current cluster\nFor example:\nIn cluster profile:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fusecli cluster view\n| NAME | CLUSTER | COMPONENT | STATUS | TLS |\n| query-1 | GKE | datafuse-query | running | enabled |\n| query-2 | GKE | datafuse-query | running | enabled |\n| query-3 | GKE | datafuse-query | pending | enabled |\n| store-1 | GKE | datafuse-store | running | enabled |\n| store-2 | GKE | datafuse-store | running | enabled |\n")),(0,r.kt)("p",null,"Check on disk utilization"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fusecli cluster df\n| NAME | COMPONENT | USED | ALWAYABLE | LOCATION |\n| local-disk-1 | Block| 10Gi | 90Gi | /mnt/fuse-store |\n| s3-disk | Object| 100 Gi | 1000Gi | s3://bucket-1/mnt/fuse-store |\n")),(0,r.kt)("h3",{id:"cluster-delete"},"Cluster delete"),(0,r.kt)("p",null,"For local profile, pids in running instances shall be killed, and for cluster profile, computing pods would be deleted, can add some flags to delete disk resources as well( RBAC needed)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fusecli cluster delete\n")),(0,r.kt)("h3",{id:"cluster-log"},"Cluster log"),(0,r.kt)("p",null,"Show logs in current running instance"),(0,r.kt)("p",null,"show all fuse-query logs"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fusecli cluster log --component=query --all\n")),(0,r.kt)("p",null,"The command above would show all fuse-store logs"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fusecli cluster log --component=store --all\n")),(0,r.kt)("p",null,"The command above would show datafuse operator logs"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fusecli cluster log --component=operator\n")),(0,r.kt)("h3",{id:"cluster-add"},"Cluster add"),(0,r.kt)("p",null,"Add component to current storage"),(0,r.kt)("p",null,"The following command add two query nodes, each need 2 cpu resource"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fusecli cluster add --component query --num 2 --cpu 2 --namespace=<operator namespace>\n")),(0,r.kt)("h3",{id:"cluster-use"},"Cluster use"),(0,r.kt)("p",null,"Switch to another cluster\nThe Command will switch to another cluster run on GKE cloud"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fusecli cluster use --name cloud-instance-1 --cluster GKE --kubeconfig ~/.kube/config --kubecontext gke-cloud-1\n")),(0,r.kt)("h3",{id:"cluster-check"},"Cluster Check"),(0,r.kt)("p",null,"Check whether current configuration can be deployed on given cluster"),(0,r.kt)("p",null,"It will check on port availability, and storage resource availability for deployment"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fusecli cluster check --profile=local\n")),(0,r.kt)("p",null,"It will check on cloud resources, whether compute nodes could be scheduled on given cloud platform, whether TLS configured etc"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fusecli cluster check -f deploy.yaml\n")),(0,r.kt)("h3",{id:"cluster-analyze"},"Cluster Analyze"),(0,r.kt)("p",null,"Analyze and troubleshooting on given configuration, difference between analyze and check is that analyze is troubleshooting on a running cluster, and check mainly used for pre-fight check"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fusecli cluster analyze --profile=local\n")),(0,r.kt)("h3",{id:"cluster-update"},"Cluster Update"),(0,r.kt)("p",null,"Update cluster to a newer version"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fusecli cluster update v0.5.1-nightly\n")),(0,r.kt)("h3",{id:"query"},"Query"),(0,r.kt)("p",null,"Run query using selected client"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fusecli query 'SELECT * FROM TABLE1' --client=mysql\n")))}p.isMDXComponent=!0}}]);