"use strict";(self.webpackChunkdatafuse=self.webpackChunkdatafuse||[]).push([[5270],{3905:function(e,t,r){r.d(t,{Zo:function(){return c},kt:function(){return f}});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var i=n.createContext({}),p=function(e){var t=n.useContext(i),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},c=function(e){var t=p(e.components);return n.createElement(i.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=p(r),f=a,d=m["".concat(i,".").concat(f)]||m[f]||u[f]||o;return r?n.createElement(d,l(l({ref:t},c),{},{components:r})):n.createElement(d,l({ref:t},c))}));function f(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,l=new Array(o);l[0]=m;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:a,l[1]=s;for(var p=2;p<o;p++)l[p]=r[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},8065:function(e,t,r){r.r(t),r.d(t,{frontMatter:function(){return s},contentTitle:function(){return i},metadata:function(){return p},toc:function(){return c},default:function(){return m}});var n=r(7462),a=r(3366),o=(r(7294),r(3905)),l=["components"],s={id:"Performance-Test",title:"Performance Test",sidebar_position:5},i="Design of test infra for performance test",p={unversionedId:"development/rfcs/Performance-Test",id:"development/rfcs/Performance-Test",isDocsHomePage:!1,title:"Performance Test",description:"Currently, we have already supports to run performance tests locally in tests/perfs directory, and here we need to support performance testing in CI",source:"@site/docs/development/rfcs/0004-performance-test.md",sourceDirName:"development/rfcs",slug:"/development/rfcs/Performance-Test",permalink:"/docs/development/rfcs/Performance-Test",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/development/rfcs/0004-performance-test.md",version:"current",sidebarPosition:5,frontMatter:{id:"Performance-Test",title:"Performance Test",sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"DatafuseStore Design",permalink:"/docs/development/rfcs/datafuse-store-design"},next:{title:"DatafuseCli Design",permalink:"/docs/development/rfcs/DatafuseCli-Design"}},c=[{value:"Goals",id:"goals",children:[]},{value:"Non Goals",id:"non-goals",children:[]},{value:"Performance Test API",id:"performance-test-api",children:[]}],u={toc:c};function m(e){var t=e.components,r=(0,a.Z)(e,l);return(0,o.kt)("wrapper",(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"design-of-test-infra-for-performance-test"},"Design of test infra for performance test"),(0,o.kt)("p",null,"Currently, we have already supports to run performance tests locally in tests/perfs directory, and here we need to support performance testing in CI"),(0,o.kt)("p",null,"Decoupling compute and storage allow datafuse to integrate into kubernetes easily.\nWith the support of kubernetes platform, datafuse benchmarking could achieve the following advantages:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Stable benchmarking results, with containerization and cgroup, easy testing instance could have idempotence computing resource"),(0,o.kt)("li",{parentName:"ol"},"Elastic, can expand or shrink tests on demand and also supports to run test locally(minikube + DinD) or on the cloud"),(0,o.kt)("li",{parentName:"ol"},"For following tests, we need to test on TPC benchmark and integrate datafuse-store storage layer to test infrastructure, thus far kubernetes can help instance scaling easily")),(0,o.kt)("h2",{id:"goals"},"Goals"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Fast CI speed is desired, By design one performance testing should not exceed two hours(including docker build time and performance testing running time)"),(0,o.kt)("li",{parentName:"ol"},"Expandable: supports to deploy performance tests on scale, and also supports to deploy on a single machine for affordable CI"),(0,o.kt)("li",{parentName:"ol"},"Cloud Native environment supports: Should be able to deploy whole platform on different cloud providers like GKE, EKS"),(0,o.kt)("li",{parentName:"ol"},"High Availability: both webhook and runner should support to self-healing and do not have single point failure"),(0,o.kt)("li",{parentName:"ol"},"Observability: whole process should be observable, should collect logs for performance running instances and collect compare report results")),(0,o.kt)("h2",{id:"non-goals"},"Non Goals"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Hybrid Cloud not supported for alpha version"),(0,o.kt)("li",{parentName:"ol"},"Networking optimization for github action part(typically CI fail is caused by networking problem"),(0,o.kt)("li",{parentName:"ol"},"Dashboard(Currently, prototype implemented, but priority here is low)")),(0,o.kt)("h2",{id:"performance-test-api"},"Performance Test API"),(0,o.kt)("p",null,"Support three semantics"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"/run-perf <branch-name>\n")),(0,o.kt)("p",null,"Compare performance difference between current pull requests\u2019 latest SHA build and given branch name"),(0,o.kt)("p",null,"Branch-name supports:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Master branch: master (some repo is main)"),(0,o.kt)("li",{parentName:"ol"},"Release tag branch: i,e v1.1.1-nightly"),(0,o.kt)("li",{parentName:"ol"},"Latest tag: fetch the latest tag in the github repo")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"/rerun-perf <branch-name>\n")),(0,o.kt)("p",null,"Similar to run-perf part, the ONLY difference is that it would bypass docker build part and assume performance docker build images are ready for test"),(0,o.kt)("p",null,"Examples:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"/run-perf master\n")),(0,o.kt)("p",null,"It will compare performance between current PR\u2019s latest commit and master branch"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"/run-perf v1.1.1-nightly\n")),(0,o.kt)("p",null,"It will compare performance between current PR\u2019s latest commit and release tag v1.1.1-nightly"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"/run-perf latest\n")),(0,o.kt)("p",null,"It will compare performance between current PR\u2019s latest commit and the latest release tag"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"/rerun-perf master\n")),(0,o.kt)("p",null,"Do the same thing as ",(0,o.kt)("inlineCode",{parentName:"p"},"/run-perf master")," did, but will skip docker image building steps"),(0,o.kt)("p",null,"For more information please checkout ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/datafuselabs/test-infra"},"test-infra")))}m.isMDXComponent=!0}}]);