<!doctype html>
<html lang="zh-CN" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/zh-CN/blog/rss.xml" title="Datafuse Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-CN/blog/atom.xml" title="Datafuse Blog Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/zh-CN/weekly/rss.xml" title="Datafuse Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-CN/weekly/atom.xml" title="Datafuse Blog Atom Feed"><title data-react-helmet="true">DatafuseQuery Shuffle | Datafuse</title><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/zh-CN/docs/development/rfcs/DatafuseQuery-Shuffle"><meta data-react-helmet="true" name="docusaurus_locale" content="zh-CN"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="DatafuseQuery Shuffle | Datafuse"><meta data-react-helmet="true" name="description" content="Summary"><meta data-react-helmet="true" property="og:description" content="Summary"><link data-react-helmet="true" rel="shortcut icon" href="/zh-CN/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/zh-CN/docs/development/rfcs/DatafuseQuery-Shuffle"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/development/rfcs/DatafuseQuery-Shuffle" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/zh-CN/docs/development/rfcs/DatafuseQuery-Shuffle" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/development/rfcs/DatafuseQuery-Shuffle" hreflang="x-default"><link rel="stylesheet" href="/zh-CN/assets/css/styles.034f4e54.css">
<link rel="preload" href="/zh-CN/assets/js/runtime~main.07da80af.js" as="script">
<link rel="preload" href="/zh-CN/assets/js/main.22433080.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-CN/"><img src="/zh-CN/img/favicon.png" alt="Datafuse Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/zh-CN/img/favicon.png" alt="Datafuse Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Datafuse</b></a><a class="navbar__item navbar__link navbar__link--active" href="/zh-CN/docs/intro">Documentation</a><a class="navbar__item navbar__link" href="/zh-CN/blog">Blog</a><a class="navbar__item navbar__link" href="/zh-CN/weekly">Weekly</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>ä¸­æ–‡ï¼ˆä¸­å›½ï¼‰</span></span></a><ul class="dropdown__menu"><li><a href="/docs/development/rfcs/DatafuseQuery-Shuffle" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/zh-CN/docs/development/rfcs/DatafuseQuery-Shuffle" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">ä¸­æ–‡ï¼ˆä¸­å›½ï¼‰</a></li></ul></div><a href="https://github.com/datafuselabs/datafuse" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/zh-CN/docs/intro">Why is Datafuse?</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">SQL Reference</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Deveplop Tutorial</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/development/development-contributing">Contribution Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/development/development-codingguidelines">Coding Guidelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/development/development-tracing">Tracing in Datafuse</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/development/development-howtoprofile">How to profile Datafuse</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/development/development-roadmap">Roadmap 2021</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">RFCs</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/development/rfcs/join-framework">Proposal: Join framework</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/development/rfcs/DatafuseQuery-Expression">DatafuseQuery Expression</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/zh-CN/docs/development/rfcs/DatafuseQuery-Shuffle">DatafuseQuery Shuffle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/development/rfcs/datafuse-store-design">DatafuseStore Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/development/rfcs/Performance-Test">Performance Test</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/development/rfcs/DatafuseCli-Design">DatafuseCli Design</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">policies</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Distributed query and data shuffle</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>Distributed query is distributed database necessary feature.
This doc is intended to explain the distributed query and its data flow design.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="local-query"></a>Local query<a class="hash-link" href="#local-query" title="Direct link to heading">#</a></h2><p>Let&#x27;s see how normal queries run on a single database node.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;        +------+       +------------+      +---------+</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;        |      |  AST  |            | Plan |         |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; SQL---&gt;|Parser+------&gt;|Plan Builder+-----&gt;|Optimizer|</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;        |      |       |            |      |         |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;        +------+       +------------+      +---+-----+</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                               | Plan</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                               v</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                 +----------+            +-----------+</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                 |          |  Processor |           |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;     Data &lt;------+DataStream|&lt;-----------+Interpreter|</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                 |          |            |           |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                 +----------+            +-----------+</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="parser-and-ast"></a>Parser and AST<a class="hash-link" href="#parser-and-ast" title="Direct link to heading">#</a></h3><p>DataFuse uses the third-party SQL parser and its AST.
For more information, see: <a href="https://github.com/ballista-compute/sqlparser-rs" target="_blank" rel="noopener noreferrer">https://github.com/ballista-compute/sqlparser-rs</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="planbuilder-and-plan"></a>PlanBuilder and Plan<a class="hash-link" href="#planbuilder-and-plan" title="Direct link to heading">#</a></h3><p>A query plan (or query execution plan) is a sequence of steps used to access data in DataFuse. It is built by PlanBuilder from AST. We also use tree to describe it(similar to AST). But it has some differences with AST:</p><ul><li>Plan is serializable and deserializable.</li><li>Plan is grammatically safe, we don&#x27;t worry about it.</li><li>Plan is used to describe the computation and data dependency, not related to syntax priority</li><li>We can show it with <code>EXPLAIN SELECT ...</code></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; EXPLAIN SELECT number % 3 AS key, SUM(number) AS value FROM numbers(1000) WHERE number &gt; 10 AND number &lt; 990 GROUP BY key ORDER BY key ASC LIMIT 10;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| explain                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| Limit: 10</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Projection: (number % 3) as key:UInt8, SUM(number) as value:UInt64</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Sort: (number % 3):UInt8,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      AggregatorFinal: groupBy=[[(number % 3)]], aggr=[[SUM(number)]]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        AggregatorPartial: groupBy=[[(number % 3)]], aggr=[[SUM(number)]]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          Expression: (number % 3):UInt8, number:UInt64 (Before GroupBy)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            Filter: ((number &gt; 10) AND (number &lt; 990))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              ReadDataSource: scan partitions: [8], scan schema: [number:UInt64], statistics: [read_rows: 1000, read_bytes: 8000] |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="optimizer-and-plan"></a>Optimizer and Plan<a class="hash-link" href="#optimizer-and-plan" title="Direct link to heading">#</a></h3><p>For a query, especially a complex query, you can used different plan combinations, orders and structures to get the data . Each of the different ways will get different processing time. So we need to find a reasonable plan combination way in the shortest time, which is what the optimizer does.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="interpreter-and-processor"></a>Interpreter and Processor<a class="hash-link" href="#interpreter-and-processor" title="Direct link to heading">#</a></h3><p>The interpreter constructs the optimized plan into an executable data stream. We pull the result of SQL by pulling the data in the stream. The calculation logic of each operator in SQL corresponds to a processor, such as FilterPlan -&gt; FilterProcessor, ProjectionPlan -&gt; ProjectionProcessor</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="distributed-query"></a>Distributed query<a class="hash-link" href="#distributed-query" title="Direct link to heading">#</a></h2><p>In the cluster mode, we may have to process with some problems different from the standalone mode.</p><ul><li>In distributed mode, the tables to be queried are always distributed in different nodes</li><li>For some scenarios, distributed processing is always efficient, such as GROUP BY with keys, JOIN</li><li>For some scenarios, we have no way of distributed processing, such as LIMIT, GROUP BY without keys</li><li>In order to ensure fast calculation, we need to coordinate the location of calculation and data.</li></ul><p>Let&#x27;s see how normal queries run on a database cluster.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                              +------+       +------------+      +------------------+</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                              |      |  AST  |            | Plan |    Optimizer     |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                       SQL---&gt;|Parser+------&gt;|Plan Builder+-----&gt;|                  |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                              |      |       |            |      | ScatterOptimizer |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                              +------+       +------------+      +--------+---------+</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                                                          |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                        +--------------+                                  |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                        |              |                                  |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     +--+ FlightStream | &lt;------+                         |  Plan</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     |  |              |        |                         |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     |  +--------------+        |                         |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     |                          |                         |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     |                          |                         |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     |                          |    Flight RPC           v</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;        +----------+    Processor    |  +--------------+        |                  +----------------+</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;        |          | RemoteProcessor |  |              |        |     do_action    |  Interpreter   |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; Data&lt;--+DataStream|&lt;----------------+--+ FlightStream | &lt;------+------------------+                |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;        |          |                 |  |              |        |                  | PlanRescheduler|</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;        +----------+                 |  +--------------+        |                  +----------------+</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     |                          |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     |                          |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     |                          |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     |                          |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     |  +--------------+        |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     |  |              |        |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     +--+ FlightStream | &lt;------+</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                        |              |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                        +--------------+</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="scatteroptimizer-and-stageplan"></a>ScatterOptimizer and StagePlan<a class="hash-link" href="#scatteroptimizer-and-stageplan" title="Direct link to heading">#</a></h3><p>In Datafuse, we use ScatterOptimizer to decide the distributed computing of query. In other words, distributed query is an optimization of standalone query.</p><p>In ScatterOptimizer, we traverse all the plans of the query and rewrite the plan of interest(rewrite as StagePlan { kind:StageKind, input:Self }), where input is the rewritten plan, and kind is an enumeration(Normal: data is shuffled again, Expansive: data spreads from one node to multiple nodes, Convergent: data aggregation from multiple nodes to one node)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="planscheduler-and-remoteprocessor"></a>PlanScheduler and RemoteProcessor<a class="hash-link" href="#planscheduler-and-remoteprocessor" title="Direct link to heading">#</a></h3><p>In cluster mode, we extract all the StagePlans in the plan optimized by ScatterOptimizer and send them to the corresponding nodes in the cluster according to the kind.</p><p>For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; EXPLAIN SELECT argMin(user, salary)  FROM (SELECT sum(number) AS salary, number%3 AS user FROM numbers_local(1000000000) GROUP BY user);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| explain                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| Projection: argMin(user, salary):UInt64   &lt;-- execute in local node</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  AggregatorFinal: groupBy=[[]], aggr=[[argMin(user, salary)]]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    RedistributeStage[expr: 0]    &lt;-- execute in all nodes of the cluster</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      AggregatorPartial: groupBy=[[]], aggr=[[argMin(user, salary)]]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        Projection: sum(number) as salary:UInt64, (number % 3) as user:UInt8</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  AggregatorFinal: groupBy=[[(number % 3)]], aggr=[[sum(number)]]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    RedistributeStage[expr: sipHash(_group_by_key)]   &lt;-- execute in all nodes of the cluster</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      AggregatorPartial: groupBy=[[(number % 3)]], aggr=[[sum(number)]]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        Expression: (number % 3):UInt8, number:UInt64 (Before GroupBy)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          RedistributeStage[expr: blockNumber()]    &lt;-- execute in local node</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            ReadDataSource: scan partitions: [8], scan schema: [number:UInt64], statistics: [read_rows: 1000000000, read_bytes: 8000000000] |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="flight-api-datastream"></a>Flight API DataStream<a class="hash-link" href="#flight-api-datastream" title="Direct link to heading">#</a></h3><p>We need to fetch the results of the plans sent to other nodes for execution in some way. FuseData uses the third-party library arrow-flight. more information:[https://github.com/apache/arrow-rs/tree/master/arrow-flight]</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/development/rfcs/0003-data-shuffle.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh-CN/docs/development/rfcs/DatafuseQuery-Expression"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« DatafuseQuery Expression</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh-CN/docs/development/rfcs/datafuse-store-design"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">DatafuseStore Design Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary" class="table-of-contents__link">Summary</a></li><li><a href="#local-query" class="table-of-contents__link">Local query</a><ul><li><a href="#parser-and-ast" class="table-of-contents__link">Parser and AST</a></li><li><a href="#planbuilder-and-plan" class="table-of-contents__link">PlanBuilder and Plan</a></li><li><a href="#optimizer-and-plan" class="table-of-contents__link">Optimizer and Plan</a></li><li><a href="#interpreter-and-processor" class="table-of-contents__link">Interpreter and Processor</a></li></ul></li><li><a href="#distributed-query" class="table-of-contents__link">Distributed query</a><ul><li><a href="#scatteroptimizer-and-stageplan" class="table-of-contents__link">ScatterOptimizer and StagePlan</a></li><li><a href="#planscheduler-and-remoteprocessor" class="table-of-contents__link">PlanScheduler and RemoteProcessor</a></li><li><a href="#flight-api-datastream" class="table-of-contents__link">Flight API DataStream</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/datafuselabs/datafuse" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>weekly<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/datafuselabs/datafuse" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â©2021 Datafuse Labs. Built with Docusaurus.</div></div></div></footer></div>
<script src="/zh-CN/assets/js/runtime~main.07da80af.js"></script>
<script src="/zh-CN/assets/js/main.22433080.js"></script>
</body>
</html>